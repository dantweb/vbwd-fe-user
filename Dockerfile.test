FROM node:20

WORKDIR /app

# Copy entire repo (vbwd-fe-core submodule must be present - clone with --recurse-submodules)
COPY . .

# Build the core library first so the file: dependency resolves
# Remove node_modules after build to prevent npm conflict with parent install
RUN cd vbwd-fe-core && npm install && npm run build && rm -rf node_modules

# Install main app (resolves vbwd-view-component from ./vbwd-fe-core)
RUN npm install

CMD ["npm", "run", "test"]
